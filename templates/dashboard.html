{% extends "base.html" %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - Python Study App{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
        <p class="text-muted">ã“ã‚“ã«ã¡ã¯ã€{{ current_user.username }}ã•ã‚“ï¼</p>
    </div>
</div>

{% if not current_user.learning_goal %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h5><i class="fas fa-user-cog"></i> ã‚ˆã‚Šè‰¯ã„å­¦ç¿’ä½“é¨“ã®ãŸã‚ã«</h5>
            <p>ã‚ãªãŸã®å­¦ç¿’ç›®æ¨™ã‚„èˆˆå‘³ã«åˆã‚ã›ãŸæœ€é©ãªå•é¡Œã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
            <a href="{{ url_for('edit_profile') }}" class="btn btn-primary">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹</a>
        </div>
    </div>
</div>
{% endif %}

{% if recommended_exams %}
<div class="row mt-4">
    <div class="col-12">
        <h3><i class="fas fa-star text-warning"></i> ã‚ãªãŸã¸ã®æ¨å¥¨è©¦é¨“</h3>
    </div>
</div>

{% for recommendation in recommended_exams %}
<div class="row mt-3">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">{{ recommendation.reason }}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for exam in recommendation.exams %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title">{{ exam.title }}</h6>
                                    {% if exam.difficulty == 'beginner' %}
                                        <span class="badge bg-success">åˆç´š</span>
                                    {% elif exam.difficulty == 'intermediate' %}
                                        <span class="badge bg-warning">ä¸­ç´š</span>
                                    {% else %}
                                        <span class="badge bg-danger">ä¸Šç´š</span>
                                    {% endif %}
                                </div>
                                <p class="card-text small">{{ exam.description }}</p>
                                <a href="{{ url_for('take_exam', exam_id=exam.id) }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-play"></i> å—é¨“ã™ã‚‹
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <h3>ã™ã¹ã¦ã®è©¦é¨“</h3>
    </div>
</div>

<div class="row">
    {% for exam in exams %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 exam-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="card-title">{{ exam.title }}</h5>
                    {% if exam.difficulty == 'beginner' %}
                        <span class="badge bg-success">åˆç´š</span>
                    {% elif exam.difficulty == 'intermediate' %}
                        <span class="badge bg-warning">ä¸­ç´š</span>
                    {% else %}
                        <span class="badge bg-danger">ä¸Šç´š</span>
                    {% endif %}
                </div>
                <p class="card-text">{{ exam.description }}</p>
                <div class="mt-auto">
                    <a href="{{ url_for('take_exam', exam_id=exam.id) }}" class="btn btn-primary">å—é¨“ã™ã‚‹</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if recent_results %}
<div class="row mt-5">
    <div class="col-12">
        <h3>æœ€è¿‘ã®å—é¨“çµæœ</h3>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>è©¦é¨“å</th>
                        <th>å¾—ç‚¹</th>
                        <th>æ­£ç­”ç‡</th>
                        <th>å—é¨“æ—¥æ™‚</th>
                        <th>è©³ç´°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in recent_results %}
                    <tr>
                        <td>{{ result.exam.title }}</td>
                        <td>{{ result.score }}/{{ result.total_questions }}</td>
                        <td>
                            {% set percentage = (result.score / result.total_questions * 100) | round(1) %}
                            <div class="progress" style="width: 100px;">
                                <div class="progress-bar 
                                    {% if percentage >= 80 %}bg-success
                                    {% elif percentage >= 60 %}bg-warning
                                    {% else %}bg-danger
                                    {% endif %}" 
                                    role="progressbar" 
                                    style="width: {{ percentage }}%;">
                                    {{ percentage }}%
                                </div>
                            </div>
                        </td>
                        <td>{{ result.completed_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('exam_result', result_id=result.id) }}" class="btn btn-sm btn-outline-primary">è©³ç´°</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">å­¦ç¿’ã®ãƒ’ãƒ³ãƒˆ</h5>
                <ul class="list-unstyled">
                    <li>ğŸ“š ã¾ãšã¯åŸºç¤è©¦é¨“ã‹ã‚‰å§‹ã‚ã¦ã€æ®µéšçš„ã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†</li>
                    <li>ğŸ”„ é–“é•ãˆãŸå•é¡Œã¯è§£èª¬ã‚’ã‚ˆãèª­ã‚“ã§ã€ç†è§£ã‚’æ·±ã‚ã¾ã—ã‚‡ã†</li>
                    <li>ğŸ“ˆ å®šæœŸçš„ã«å—é¨“ã—ã¦ã€å­¦ç¿’ã®é€²æ—ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</li>
                    <li>ğŸ¯ è‹¦æ‰‹åˆ†é‡ã‚’ç‰¹å®šã—ã€é‡ç‚¹çš„ã«å­¦ç¿’ã—ã¾ã—ã‚‡ã†</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}